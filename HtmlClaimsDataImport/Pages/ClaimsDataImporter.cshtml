@page
@model HtmlClaimsDataImport.Pages.ClaimsDataImporterModel
@{
    ViewData["Title"] = "Claims Data Importer";
}

<script src="https://unpkg.com/htmx.org@2.0.6"></script>

<style>
    .nav-header {
        border-bottom: 1px solid #ddd;
        padding: 10px 20px;
        background-color: #f8f9fa;
    }
    
    .nav-menu {
        display: flex;
        gap: 20px;
        margin: 0;
        padding: 0;
        list-style: none;
    }
    
    .nav-menu li {
        cursor: pointer;
        padding: 8px 16px;
        border-radius: 4px;
    }
    
    .nav-menu li.active {
        background-color: #007bff;
        color: white;
    }
    
    .nav-menu li:hover:not(.active) {
        background-color: #e9ecef;
    }
    
    .main-container {
        display: flex;
        height: calc(100vh - 60px);
    }
    
    .sidebar {
        width: 200px;
        border-right: 1px solid #ddd;
        background-color: #f8f9fa;
        padding: 20px;
    }
    
    .sidebar ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .sidebar li {
        padding: 8px 12px;
        cursor: pointer;
        border-radius: 4px;
        margin-bottom: 5px;
    }
    
    .sidebar li.active {
        background-color: #007bff;
        color: white;
    }
    
    .sidebar li:hover:not(.active) {
        background-color: #e9ecef;
    }
    
    .content-area {
        flex: 1;
        padding: 20px;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: inline-block;
        width: 80px;
        font-weight: bold;
    }
    
    .form-group input {
        width: 300px;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }
    
    .browse-btn {
        margin-left: 10px;
        padding: 8px 16px;
        background-color: #6c757d;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    
    .browse-btn:hover {
        background-color: #5a6268;
    }
    
    .file-input {
        display: none;
    }
    
    .file-status {
        margin-left: 10px;
        color: #6c757d;
        font-style: italic;
    }
    
    .hidden {
        display: none;
    }
</style>

<div class="nav-header">
    <ul class="nav-menu">
        <li class="active" onclick="showHome()">Home</li>
        <li onclick="showPreview()">Preview</li>
    </ul>
</div>

<div class="main-container">
    <div class="sidebar" id="home-sidebar">
        <ul>
            <li class="active" onclick="showConfig()">Config</li>
        </ul>
    </div>
    
    <div class="sidebar hidden" id="preview-sidebar">
        <!-- Preview sidebar content would go here -->
    </div>
    
    <div class="content-area">
        <div id="config-content">
            <form method="post">
                <div class="form-group">
                    <label for="jsonFile">json:</label>
                    <input type="text" id="jsonFile" name="JsonFile" value="@Model.JsonFile" readonly />
                    <input type="file" id="jsonFileInput" class="file-input" accept=".json" onchange="handleFileSelect('json')" />
                    <button type="button" class="browse-btn" onclick="document.getElementById('jsonFileInput').click()">Browse</button>
                    <span id="json-status" class="file-status">@Model.JsonFileStatus</span>
                </div>
                
                <div class="form-group">
                    <label for="fileName">filename:</label>
                    <input type="text" id="fileName" name="FileName" value="@Model.FileName" readonly />
                    <input type="file" id="fileNameInput" class="file-input" accept=".csv,.txt" onchange="handleFileSelect('filename')" />
                    <button type="button" class="browse-btn" onclick="document.getElementById('fileNameInput').click()">Browse</button>
                    <span id="filename-status" class="file-status">@Model.FileNameStatus</span>
                </div>
                
                <div class="form-group">
                    <label for="database">database:</label>
                    <input type="text" id="database" name="Database" value="@Model.Database" readonly />
                    <input type="file" id="databaseInput" class="file-input" accept=".db,.sqlite,.sqlite3" onchange="handleFileSelect('database')" />
                    <button type="button" class="browse-btn" onclick="document.getElementById('databaseInput').click()">Browse</button>
                    <span id="database-status" class="file-status">@Model.DatabaseStatus</span>
                </div>
            </form>
        </div>
        
        <div id="preview-content" class="hidden">
            <h3>Preview Content</h3>
            <p>Preview functionality will be implemented here.</p>
        </div>
    </div>
</div>

<script>
    function showHome() {
        document.querySelector('.nav-menu li.active').classList.remove('active');
        event.target.classList.add('active');
        
        document.getElementById('home-sidebar').classList.remove('hidden');
        document.getElementById('preview-sidebar').classList.add('hidden');
        
        document.getElementById('config-content').classList.remove('hidden');
        document.getElementById('preview-content').classList.add('hidden');
    }
    
    function showPreview() {
        document.querySelector('.nav-menu li.active').classList.remove('active');
        event.target.classList.add('active');
        
        document.getElementById('home-sidebar').classList.add('hidden');
        document.getElementById('preview-sidebar').classList.remove('hidden');
        
        document.getElementById('config-content').classList.add('hidden');
        document.getElementById('preview-content').classList.remove('hidden');
    }
    
    function showConfig() {
        // Config is the only option in Home sidebar for now
        document.querySelector('#home-sidebar li.active').classList.remove('active');
        event.target.classList.add('active');
    }
    
    function handleFileSelect(fileType) {
        let inputElement, textElement, statusTarget;
        
        switch(fileType) {
            case 'json':
                inputElement = document.getElementById('jsonFileInput');
                textElement = document.getElementById('jsonFile');
                statusTarget = '#json-status';
                break;
            case 'filename':
                inputElement = document.getElementById('fileNameInput');
                textElement = document.getElementById('fileName');
                statusTarget = '#filename-status';
                break;
            case 'database':
                inputElement = document.getElementById('databaseInput');
                textElement = document.getElementById('database');
                statusTarget = '#database-status';
                break;
        }
        
        if (inputElement.files.length > 0) {
            const selectedFile = inputElement.files[0];
            textElement.value = selectedFile.name;
            
            // Use HTMX to update status via server
            const token = document.querySelector('input[name="__RequestVerificationToken"]').value;
            htmx.ajax('POST', '/ClaimsDataImporter?handler=FileSelected', {
                target: statusTarget,
                values: {
                    fileType: fileType,
                    fileName: selectedFile.name,
                    action: 'ok',
                    __RequestVerificationToken: token
                }
            });
        } else {
            // User cancelled - clear the field and update status
            textElement.value = '';
            
            const token = document.querySelector('input[name="__RequestVerificationToken"]').value;
            htmx.ajax('POST', '/ClaimsDataImporter?handler=FileSelected', {
                target: statusTarget,
                values: {
                    fileType: fileType,
                    fileName: '',
                    action: 'cancel',
                    __RequestVerificationToken: token
                }
            });
        }
    }
</script>